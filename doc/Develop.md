## Создание нового компонента

Ниже описаны шаги, которые необходимо пройти при написании нового компонента.

### Сообщения

Прежде всего необходимо реализовать сообщения, которыми будет оперировать компонент.

Тело сообщения должно быть конвертируемо в `JSON` или `MessagePack`, то есть наследовать один из одноимённых [классов](../mq/protocol/types.py#L4) из `mq.protocol`. Конвертация в `JSON` или `MessagePack` осуществляется методом `pack()`, который уже реализован – его переопределять не нужно.

Конвертация из `JSON` и `MessagePack` осуществляется методом `unpack()`, его реализацию пользователь задаёт сам. 
Здесь важно проверить, что во входных данных присутствуют все поля класса, а также что они требуемых типов. 
Примеры можно найти в следующих файлах: [radio_messages](../examples/radio_messages.py), [calculator_messages](../examples/calculator_messages.py), [bank_messages](../examples/bank_messages.py), [clock_messages](../examples/clock_messages.py).

### Логика компонента

После того, как объявлены сообщения, можно перейти к реализации логики компонента.

У компонента есть два уровня: технический и коммуникационный.
При разработке очередного компонента нужно реализовать логику только коммуникационного уровня.
Модуль `mq.component` экспортирует класс `Component` с не реализованным методом [run()](../mq/component/component.py#L87). Через аргументы пользователю доступны один или два входящих канала коммуникационного уровня (от scheduler и, возможно, от controller, если он определён) и один исходящий.

Также доступна переменная для установки пользовательского сообщения в мониторинге.

Простейший пример можно посмотреть в компоненте `radio-speaker`, где метод [`run()`](../examples/radio-speaker.py#L13) описывает всю логику этого компонента.

Более сложная логика реализована в компоненте `calculator`, который [принимает](../examples/calculator.py#L15) сообщение, [проверяет](../examples/calculator.py#L16), интересно ли оно ему: тип `config` и spec `example_calculator`, и [отправляет](../examples/calculator.py#L33) ответ.

В том случае, если компонент получает задачу через контроллер, сообщения будут приходить через [исходящий](../examples/clock-reply.py#L16) канал контроллера.

Этого достаточно для того, чтобы реализовать практически любую логику.

**НАСТОЯТЕЛЬНО** рекомендуется пользоваться методом [write_log](../mq/component/component.py#L98) и записывать информативные логи.

### Запускаемое приложение

Для запуска компонента достаточно [создать](../examples/calculator.py#L37) объект класса.

Единственным аргументом конструктора идёт имя компонента.
Правила его именования, а также то, как это имя должно соотноситься с конфигурационным файлом, описано в [этом](https://github.com/biocad/mq/blob/master/doc/ConfigJson.md) документе.

