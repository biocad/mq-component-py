# mq-component-py
Python component for MoniQue.

Порядок написания модулей:
1. [Типы](mq/protocol/types.py). Содержит описание сообщения. 
2. [Функции](mq/protocol/functions.py). Содержит функции для работы с сообщениями: создание, конвертация в/из MessagePack и т.д. 
3. [Тэг](mq/protocol/tag.py). Содержит функции для работы с тэгом: создание, обращение к полям.
4. [Компонент](mq/component/component.py). Содержит класс Компонент, позволяющий слушать и отправлять сообщения, а также выполнять некоторую полезную работу.
5. [Технический канал](mq/component/technical.py). Содержит функцию обработки технических сообщений.
6. [Коммуникационный канал](mq/component/communication.py). Содержит функцию обработки коммуникационных сообщений.
7. [Мониторинг](mq/component/monitoring.py). Содержит логику компонента мониторинга. 

## Установка
Необходима библиотека `pyzmq`. Её можно установить с помощью пакетного менеджера `pip3`:
```bash
pip3 install pyzmq
```

Непосредственно библиотеку с компонентом можно установить с помощью следующих команд:
```bash
git clone https://github.com/biocad/mq-component-py.git
cd mq-component-py
python3 setup.py install
```

После установки для импорта будут доступны три модуля:
1. `mq.protocol`: типы `Message`, `MonitoringResult`, функции для работы с тегом, запаковки/распаковки в `MessagePack`.
2. `mq.component`: класс `Component` с не реализованным методом `run()`. Для написания своего компонента необходимо создать наследника `Component` и реализовать метод `run()`. 
   Для общения с `MoniQue` доступны входящие коммуникационные каналы от центрального места и контроллера, а также исходящий канал в центральное место. [Пример](examples/simple_component.py)
3. `mq.config`: класс `Config`, который может загружать параметры из конфигурационного файла. Содержит адреса контроллера и центрального места, указание, куда писать лог и т.д.

Для удаления библиотеки необходимо выполнить
```bash
pip3 uninstall mq-component-py
```

## Запуск
Для запуска компонента необходим запущенный [scheduler](git@github.com:biocad/mq.git) – все три составные части.
После этого в корневой директории библиотеки можно выполнить

```bash
python3 examples/example-listener.py --config examples/config.json
```

Если передать компоненту сообщение, он должен распечатать его `data`. Также в мониторинг будет включено пользовательское сообщение о приёме с `id` отправителя.
В качестве источника сообщений можно запустить второй пример:

```bash
python3 examples/example-speaker.py --config examples/config.json
```
